{% macro user_link(user) -%}
<a href="{{ request.path_for(user) }}" class="username">{{ user.profile.username }}</a>
{%- endmacro %}

{% macro user_avatar(user, class_='') -%}
<a href="{{ request.path_for(user) }}" class="avatar {{ class_ }}">
  <img src="{{ user.avatar['display_url'] }}" alt="{{ user.profile.username }}â€™s avatar">
</a>
{%- endmacro %}

{% macro by_user(user) -%}
<span class="type-alt">by</span> {{ user_link(user) }}
{%- endmacro %}

{% macro datetime(dt) %}
<time class="type-secondary type-alt" datetime="{{ dt.isoformat() }}">{{ request.format_datetime(dt) }}</time>
{% endmacro %}

{% macro render_field(field) -%}
{{ field.serialize(extra_html=caller()) | safe }}
{%- endmacro %}

{% macro form_errors(errors) %}
{% if errors %}
<p>Some of the data you entered wasn't good:</p>
<ul>
  {%- for node, messages in errors -%}
  {%- set name = node.error_name | default(node.description) -%}
  {% if name %}<li>{{ name }} <ul>{% endif %}
    {% for message in messages %}<li>{{ message }}</li>{% endfor %}
  {% if name %}</ul></li>{% endif %}
  {%- endfor -%}
</ul>
{% endif %}
{% endmacro %}

{% macro login_form(form) %}
<form action="{{ request.resource_path(None, 'signin') }}" method="post" class="login-form standard-form small-width">
  {{ form_errors(errors) }}
  {{ form['csrf_token'].serialize() | safe }}
  {{ form['user'].serialize() | safe }}
  {{ form['password'].serialize() | safe }}
  <button type="submit" name="signin" class="action disclose" tabindex="1">Sign in</button>
  <ul class="actions">
    <li><a href="#">Create a new account</a></li>
    <li><a href="#">Forgot your info?</a></li>
  </ul>
</form>
{% endmacro %}

{% macro submission_thumb(submission, klass='grid-item', with_caption=True) %}
<figure class="{{ klass }}" data-init-aspect="{{ submission.submission_media['aspect_ratio'] }}">
  <a href="{{ request.path_for(submission) }}" class="thumb-container">
    <img class="thumb" src="{{ submission.submission_media['display_url'] }}" alt="" />
    <div class="rating {{ submission.rating }}">Rated {{ submission.rating }}</div>
    {% if with_caption -%}
    <figcaption class="info">
      <h4 class="title">{{ submission.title }}</h4>
      <p class="byline">{{ by_user(submission.owner) }}</p>
    </figcaption>
    {%- endif %}
  </a>
</figure>
{% endmacro %}
